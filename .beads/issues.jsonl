{"id":"bp-05y","title":"Fix WorkQuestModal to filter by active quarter","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T14:40:28.535217+07:00","created_by":"abuabdirohman","updated_at":"2026-01-12T15:18:39.515598+07:00","closed_at":"2026-01-12T15:18:39.515598+07:00","close_reason":"Closed","comments":[{"id":4,"issue_id":"bp-05y","author":"abuabdirohman","text":"\n## Problem\nWorkQuestModal di daily-sync menampilkan semua work quest dari semua quarter, bukan hanya quarter aktif.\n\n## Root Cause\n- File: src/app/(admin)/execution/daily-sync/DailyQuest/components/WorkQuestModal.tsx:39\n- Menggunakan: useWorkQuests() tanpa parameter\n- Hook ini tidak support filtering by year/quarter\n\n## Solution\n1. Import useQuarterStore untuk mendapatkan year \u0026 quarter context\n2. Ganti dari useWorkQuests() ke useWorkQuestProjects(year, quarter)\n3. Update data structure mapping karena useWorkQuestProjects return projects dengan nested tasks\n4. Current structure: workQuests (flat list)\n5. New structure: projects (list of projects with tasks)\n\n## Files to Modify\n- src/app/(admin)/execution/daily-sync/DailyQuest/components/WorkQuestModal.tsx\n\n## Implementation Details\n```typescript\n// OLD:\nconst { workQuests, isLoading: workQuestsLoading } = useWorkQuests();\n\n// NEW:\nconst { year, quarter } = useQuarterStore();\nconst { projects, isLoading: workQuestsLoading } = useWorkQuestProjects(year, quarter);\n// Then map projects to hierarchicalItems structure (already exists in modal)\n```\n\n## Testing\n- Buka daily-sync page\n- Klik tombol 'Add' di Work Quest section\n- Verify: Hanya menampilkan work quest dari quarter aktif\n- Change quarter selector\n- Verify: List quest berubah sesuai quarter yang dipilih\n","created_at":"2026-01-12T07:41:42Z"},{"id":8,"issue_id":"bp-05y","author":"abuabdirohman","text":"Fixed WorkQuestModal quarter filtering implementation:\n\n1. Updated getWorkQuests() action to accept year \u0026 quarter parameters\n2. Added quarter date filtering using getQuarterDates() (same pattern as side-quests)\n3. Filters work quests by created_at between startDate and endDate\n4. Updated useWorkQuests() hook to accept and pass year \u0026 quarter parameters\n5. Updated SWR key to include year \u0026 quarter for proper cache invalidation\n6. Updated WorkQuestModal in daily-sync to use useQuarterStore()\n7. All TypeScript checks passed\n\nChanges made:\n- src/app/(admin)/quests/work-quests/actions/workQuestActions.ts:16-44\n- src/app/(admin)/quests/work-quests/hooks/useWorkQuests.ts:27-41\n- src/app/(admin)/execution/daily-sync/DailyQuest/components/WorkQuestModal.tsx:3,40-41","created_at":"2026-01-12T08:18:31Z"}]}
{"id":"bp-0z1","title":"Build notification settings UI in settings page (MVP)","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-28T10:43:57.533626+07:00","created_by":"abuabdirohman","updated_at":"2026-01-28T10:43:57.533626+07:00","dependencies":[{"issue_id":"bp-0z1","depends_on_id":"bp-2we","type":"parent-child","created_at":"2026-01-28T10:59:18.893254+07:00","created_by":"abuabdirohman"}]}
{"id":"bp-1f6","title":"Testing: Verify all modals filter by active quarter","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T14:48:55.617685+07:00","created_by":"abuabdirohman","updated_at":"2026-01-13T05:03:41.046739+07:00","closed_at":"2026-01-13T05:03:41.046739+07:00","close_reason":"Completed with AI assistance in Google Antigravity","dependencies":[{"issue_id":"bp-1f6","depends_on_id":"bp-05y","type":"blocks","created_at":"2026-01-12T14:49:25.821204+07:00","created_by":"abuabdirohman"},{"issue_id":"bp-1f6","depends_on_id":"bp-hoz","type":"blocks","created_at":"2026-01-12T14:49:39.622555+07:00","created_by":"abuabdirohman"}],"comments":[{"id":6,"issue_id":"bp-1f6","author":"abuabdirohman","text":"\n## Purpose\nComprehensive testing untuk memastikan semua quest modals di daily-sync hanya menampilkan quest dari quarter aktif.\n\n## Prerequisites\n- bp-05y (WorkQuestModal fix) - DONE\n- bp-hoz (DailyQuestModal fix) - DONE\n\n## Test Cases\n\n### 1. WorkQuestModal\n- [ ] Buka /execution/daily-sync\n- [ ] Note current quarter (e.g., Q1 2026)\n- [ ] Click 'Add' button di Work Quest section\n- [ ] Verify: Modal hanya menampilkan work quests dari Q1 2026\n- [ ] Close modal\n- [ ] Switch quarter selector ke Q2\n- [ ] Click 'Add' button di Work Quest section\n- [ ] Verify: Modal sekarang menampilkan work quests dari Q2\n- [ ] Verify: Quest dari Q1 tidak muncul\n\n### 2. DailyQuestModal\n- [ ] Buka /execution/daily-sync\n- [ ] Note current quarter (e.g., Q1 2026)\n- [ ] Click 'Add' button di Daily Quest section\n- [ ] Verify: Modal hanya menampilkan daily quests dari Q1 2026\n- [ ] Close modal\n- [ ] Switch quarter selector ke Q2\n- [ ] Click 'Add' button di Daily Quest section\n- [ ] Verify: Modal sekarang menampilkan daily quests dari Q2\n- [ ] Verify: Quest dari Q1 tidak muncul\n\n### 3. SideQuestModal (Regression Test)\n- [ ] Buka /execution/daily-sync\n- [ ] Note current quarter (e.g., Q1 2026)\n- [ ] Click 'Add' button di Side Quest section\n- [ ] Verify: Modal hanya menampilkan side quests dari Q1 2026\n- [ ] Switch quarter selector ke Q2\n- [ ] Click 'Add' button di Side Quest section\n- [ ] Verify: Modal sekarang menampilkan side quests dari Q2\n- [ ] Verify: Masih bekerja dengan benar (tidak ada regression)\n\n### 4. Cross-Quarter Data Consistency\n- [ ] Buat work quest baru di Q1\n- [ ] Buat daily quest baru di Q1\n- [ ] Switch ke Q2\n- [ ] Verify: Quest Q1 tidak muncul di modal manapun\n- [ ] Switch kembali ke Q1\n- [ ] Verify: Quest Q1 muncul kembali\n\n### 5. Edge Cases\n- [ ] Test dengan quarter yang tidak punya quest sama sekali\n- [ ] Verify: Modal menampilkan empty state yang appropriate\n- [ ] Test dengan multiple quests (10+) di satu quarter\n- [ ] Verify: Semua quest ter-render dengan benar\n- [ ] Test search/filter di dalam modal (if applicable)\n- [ ] Verify: Search tetap dalam scope quarter aktif\n\n## Success Criteria\n- Semua 3 modals (Work, Daily, Side) hanya menampilkan quest dari quarter aktif\n- Quarter switching bekerja dengan smooth tanpa bugs\n- Tidak ada quest dari quarter lain yang muncul\n- Empty states ditampilkan dengan benar\n- No console errors\n- No performance issues\n","created_at":"2026-01-12T07:49:16Z"}]}
{"id":"bp-2we","title":"Setup email notification system with AI integration","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-28T10:42:50.566414+07:00","created_by":"abuabdirohman","updated_at":"2026-01-28T10:42:50.566414+07:00","comments":[{"id":31,"issue_id":"bp-2we","author":"abuabdirohman","text":"Email notification system dengan AI integration (Gemini API) untuk mengirim performance updates kepada users. Frequencies: daily, weekly, monthly, quarterly. Menggunakan Resend untuk email service, Vercel Cron untuk scheduling, dan 4 AI character personalities (Motivational Coach, Analytical Advisor, Balanced Mentor, Friendly Buddy). User timezone: UTC+7.","created_at":"2026-01-28T03:43:03Z"}]}
{"id":"bp-346","title":"Fix: Pomodoro timer task becomes unclickable after completion","description":"Bug: After Pomodoro timer completes, the task in the timer interface becomes unclickable. Users must click on the quest card itself to restart the timer, instead of being able to click directly on the task in the timer interface.\n\nSteps to reproduce:\n1. Start a Pomodoro timer for a task\n2. Wait for timer to complete\n3. Try to click on the task in the timer interface\n4. Task is unclickable\n\nExpected behavior: Task should remain clickable in the timer interface after completion\n\nCurrent workaround: Click on the quest card to restart timer","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-07T22:30:55.346602+07:00","created_by":"abuabdirohman","updated_at":"2026-01-12T16:43:06.493573+07:00","closed_at":"2026-01-12T16:45:00+07:00","labels":["bug","pomodoro","timer","ui"],"comments":[{"id":15,"issue_id":"bp-346","author":"system","text":"Fixed by making the entire timer area clickable with hover effects. Added e.stopPropagation() to Stop button to allow better interaction.","created_at":"2026-01-12T09:45:00Z"},{"id":17,"issue_id":"bp-346","author":"system","text":"Added scale-up animation (hover:scale-110) and press effect (active:scale-95) to the timer icon for better interactivity. Layout finalized with onClick on the IconComponent.","created_at":"2026-01-12T10:10:00Z"}]}
{"id":"bp-34i","title":"Build email queue and sending service with Resend","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-28T10:43:49.776224+07:00","created_by":"abuabdirohman","updated_at":"2026-01-28T10:43:49.776224+07:00","dependencies":[{"issue_id":"bp-34i","depends_on_id":"bp-2we","type":"parent-child","created_at":"2026-01-28T10:59:18.347159+07:00","created_by":"abuabdirohman"}]}
{"id":"bp-3bc","title":"Build performance aggregation service (daily/weekly/monthly/quarterly)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-28T10:43:35.21526+07:00","created_by":"abuabdirohman","updated_at":"2026-01-29T08:16:06.047311+07:00","closed_at":"2026-01-29T08:16:06.047311+07:00","close_reason":"Closed","dependencies":[{"issue_id":"bp-3bc","depends_on_id":"bp-2we","type":"parent-child","created_at":"2026-01-28T10:59:17.569727+07:00","created_by":"abuabdirohman"}],"comments":[{"id":40,"issue_id":"bp-3bc","author":"abuabdirohman","text":"✓ Completed: Created performance aggregation service with 4 aggregation functions (getDailyPerformance, getWeeklyPerformance, getMonthlyPerformance, getQuarterlyPerformance). Each pulls data from activity_logs, tasks, and weekly_goals tables. Includes comparison with previous period, saves to performance_summaries table. Also created period utility functions for date calculations and timezone handling (UTC+7). Files: performanceAggregation.ts, periodUtils.ts","created_at":"2026-01-29T01:16:06Z"}]}
{"id":"bp-3lo","title":"End-to-end testing and monitoring setup","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-28T10:44:05.423145+07:00","created_by":"abuabdirohman","updated_at":"2026-01-28T10:44:05.423145+07:00","dependencies":[{"issue_id":"bp-3lo","depends_on_id":"bp-2we","type":"parent-child","created_at":"2026-01-28T10:59:19.494938+07:00","created_by":"abuabdirohman"}]}
{"id":"bp-4yk","title":"Add Calendar/Timeline view to ActivityLog component","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-02-12T13:39:59.949749+07:00","created_by":"abuabdirohman","updated_at":"2026-02-12T14:54:38.877181+07:00","closed_at":"2026-02-12T14:54:38.877181+07:00","close_reason":"Closed","comments":[{"id":41,"issue_id":"bp-4yk","author":"abuabdirohman","text":"## Overview\nMenambahkan view mode CALENDAR ke ActivityLog yang menampilkan aktivitas dalam bentuk timeline blocks seperti Google Calendar.\n\n## Requirements\n- Tambah view mode baru: GROUPED, TIMELINE, dan CALENDAR\n- Timeline dengan blocks (mirip Google Calendar)\n- Opsi tampilan: 24 jam penuh atau dinamis berdasarkan aktivitas\n- Slot kosong tampil abu-abu\n- Break activities tampil dengan info \"Break\"\n- Click block untuk expand/collapse journal entries\n\n## Technical Details\n- Location: src/app/(admin)/execution/daily-sync/ActivityLog/\n- New components: CalendarView, CalendarBlock, HourlyGrid\n- New utilities: calendarUtils.ts untuk time calculations\n- Update types.ts dengan ViewMode \u0026 CalendarViewMode\n- Color-coded blocks berdasarkan quest type\n\n## Files to Create\n1. CalendarView.tsx - Main calendar component\n2. components/CalendarBlock.tsx - Individual activity blocks\n3. components/HourlyGrid.tsx - Background grid timeline\n4. utils/calendarUtils.ts - Time calculation utilities\n\n## Files to Modify\n1. ActivityLog.tsx - Add calendar view toggle\n2. types.ts - Add new types (ViewMode, CalendarBlock, TimeSlot)\n\n## Implementation Steps\n1. Update types\n2. Create utility functions (time calculations)\n3. Build HourlyGrid component\n4. Build CalendarBlock component\n5. Build CalendarView component\n6. Update ActivityLog with toggle\n7. Add styling \u0026 responsive design\n8. Test with various scenarios","created_at":"2026-02-12T06:40:18Z"}]}
{"id":"bp-5ce","title":"Fix: Milestone auto-save on blur instead of explicit Save button","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-13T08:54:09.655794+07:00","created_by":"abuabdirohman","updated_at":"2026-01-13T09:09:27.180704+07:00","closed_at":"2026-01-13T09:09:27.180704+07:00","close_reason":"Closed","comments":[{"id":25,"issue_id":"bp-5ce","author":"abuabdirohman","text":"BUG: Milestone input has onBlur handler that auto-saves when user clicks away, instead of requiring explicit Save button click.\n\nLOCATION: src/app/(admin)/planning/main-quests/Milestone/components/MilestoneItem.tsx:134-140\n\nFIX: Remove handleSave() call from handleInputBlur(), only setIsEditing(false)","created_at":"2026-01-13T01:54:49Z"},{"id":28,"issue_id":"bp-5ce","author":"abuabdirohman","text":"FIXED: Removed auto-save on blur from handleInputBlur()\n\nCHANGES:\n- MilestoneItem.tsx:134-138 - Changed handleInputBlur() to only setIsEditing(false)\n- Removed handleSave() call that was causing unwanted auto-save\n- User must now explicitly click Save button or press Enter to save milestone\n\nVERIFICATION:\n- Type check passed ✅\n- Milestone only saves when: (1) Save button clicked, (2) Enter key pressed","created_at":"2026-01-13T02:09:22Z"}]}
{"id":"bp-7ha","title":"Fix: DailyQuest modal checkbox disappearing when timer running","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-13T07:35:07.103381+07:00","created_by":"abuabdirohman","updated_at":"2026-01-13T08:32:27.402369+07:00","closed_at":"2026-01-13T08:32:27.402369+07:00","close_reason":"Closed","labels":["modal","ui"],"comments":[{"id":19,"issue_id":"bp-7ha","author":"abuabdirohman","text":"Bug: Checkbox selections di DailyQuest modal (dan modal quest lainnya) hilang/reset saat timer sedang berjalan. User tidak bisa select task karena pilihan mereka ter-reset sebelum di-save.","created_at":"2026-01-13T00:35:17Z"},{"id":20,"issue_id":"bp-7ha","author":"abuabdirohman","text":"Root Cause: Periodic revalidation (mutate() setiap 30 detik) di useDailyPlanManagement.ts membuat object dailyPlan baru, trigger re-initialization useEffect yang depend pada dailyPlan, sehingga selectedDailyQuestIds ter-reset ke database state dan user selections hilang.","created_at":"2026-01-13T00:35:30Z"},{"id":21,"issue_id":"bp-7ha","author":"abuabdirohman","text":"Solution: 1) Remove dailyPlan from dependency array pada modal initialization useEffect (lines 308-319, 373-403, 405-424), 2) Pause periodic revalidation saat modal terbuka dengan menambahkan condition check di interval (lines 341-349). File: src/app/(admin)/execution/daily-sync/DailyQuest/hooks/useDailyPlanManagement.ts","created_at":"2026-01-13T00:35:40Z"},{"id":24,"issue_id":"bp-7ha","author":"abuabdirohman","text":"FIXED:\n1. Line 320: Removed dailyPlan from useEffect dependency array that initializes selectedDailyQuestIds\n   - Only triggers when isDailyQuestModalOpen changes, preventing reset from periodic revalidation\n   - Added eslint-disable comment to suppress exhaustive-deps warning\n\n2. Lines 342-353: Added condition to pause periodic revalidation when modals are open\n   - Checks both modalState.showModal and isDailyQuestModalOpen\n   - Prevents mutate() from running every 30 seconds when user is selecting tasks\n   - User selections now persist until they click Save/Cancel\n\nVERIFICATION:\n- Type check passed successfully\n- Modal selections will no longer reset when timer is running\n- Cross-tab sync still works when modals are closed","created_at":"2026-01-13T01:32:19Z"}]}
{"id":"bp-8pd","title":"Investigate: Quest 2 Milestone 1 \u0026 2 showing same task list","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-13T08:54:25.736601+07:00","created_by":"abuabdirohman","updated_at":"2026-01-13T09:09:45.052626+07:00","closed_at":"2026-01-13T09:09:45.052626+07:00","close_reason":"Closed","comments":[{"id":26,"issue_id":"bp-8pd","author":"abuabdirohman","text":"BUG: Quest 1 shows different tasks for Milestone 1 \u0026 2 (correct), but Quest 2 shows same tasks for both milestones.\n\nINVESTIGATION NEEDED: Query database via MCP to check:\n- Quest 2 milestone IDs\n- Tasks milestone_id references for Quest 2\n- Possible data corruption or duplicate IDs\n\nLOCATION: src/app/(admin)/planning/main-quests/","created_at":"2026-01-13T01:54:54Z"},{"id":29,"issue_id":"bp-8pd","author":"abuabdirohman","text":"DIAGNOSED \u0026 FIXED: Quest 2 had duplicate milestone and task data corruption\n\nROOT CAUSE (via MCP database query):\n- Quest 2 (Konten Threads/LinkedIn/Twitter) had 2 milestones with same display_order = 1\n- Second milestone had empty title\n- Task 'Context Profile' was duplicated in both milestones\n- This caused UI to show same task list for different milestones\n\nDATABASE CLEANUP:\n- Applied migration: fix_quest2_duplicate_milestone_and_task\n- Deleted duplicate task (id: b77bfc81-574e-4a13-b4bd-0198aaa34f71)\n- Deleted empty milestone (id: 6f08333a-c9d0-4c44-9684-577d14053a2c)\n- Quest 2 now has 1 clean milestone with 2 distinct tasks\n\nVERIFICATION:\n- Queried database post-migration ✅\n- Quest 2 now shows: Milestone 1 with 2 tasks (Context Profile, Calendar Content)\n- No duplicate data remaining","created_at":"2026-01-13T02:09:42Z"}]}
{"id":"bp-b5b","title":"Setup Gemini AI integration with 4 character personalities","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-28T10:43:39.411495+07:00","created_by":"abuabdirohman","updated_at":"2026-01-28T10:43:39.411495+07:00","dependencies":[{"issue_id":"bp-b5b","depends_on_id":"bp-2we","type":"parent-child","created_at":"2026-01-28T10:59:17.895624+07:00","created_by":"abuabdirohman"}],"comments":[{"id":33,"issue_id":"bp-b5b","author":"abuabdirohman","text":"Install @google/generative-ai package. Create 4 AI character prompts: Motivational Coach, Analytical Advisor, Balanced Mentor, Friendly Buddy. Build service untuk generate insights berdasarkan performance data. Gemini 1.5 Flash model (free tier).","created_at":"2026-01-28T03:59:41Z"}]}
{"id":"bp-c5z","title":"Fix: Motivation field inconsistency after save/refresh","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-13T08:54:30.427469+07:00","created_by":"abuabdirohman","updated_at":"2026-01-13T09:10:03.581279+07:00","closed_at":"2026-01-13T09:10:03.581279+07:00","close_reason":"Closed","comments":[{"id":27,"issue_id":"bp-c5z","author":"abuabdirohman","text":"BUG: After saving motivation field, first refresh shows empty, second refresh shows correct data.\n\nROOT CAUSE: SWR cache not invalidated after updateQuestMotivation() server action.\n\nFIX: Pass SWR mutate function from MainQuestsClient to Quest component, call mutate() after successful save.\n\nLOCATION: src/app/(admin)/planning/main-quests/Quest.tsx \u0026 MainQuestsClient.tsx","created_at":"2026-01-13T01:54:58Z"},{"id":30,"issue_id":"bp-c5z","author":"abuabdirohman","text":"FIXED: SWR cache not invalidated after motivation save\n\nROOT CAUSE:\n- updateQuestMotivation() server action only called revalidatePath()\n- Client-side SWR cache was never invalidated\n- First refresh: race condition\n- Second refresh: finally synced\n\nSOLUTION (Pass SWR mutate approach):\n1. MainQuestsClient.tsx:16 - Extract mutate from useMainQuests hook\n2. MainQuestsClient.tsx:122 - Pass mutate as onQuestUpdate prop to Quest\n3. Quest.tsx:25 - Accept onQuestUpdate prop (optional)\n4. Quest.tsx:55-57 - Call onQuestUpdate() after successful save to invalidate cache\n\nVERIFICATION:\n- Type check passed ✅\n- Motivation now shows immediately after save without double refresh\n- Clean, standard approach using SWR's built-in cache invalidation","created_at":"2026-01-13T02:09:57Z"}]}
{"id":"bp-ckc","title":"Update user_profiles schema untuk notification preferences","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-28T10:43:20.98575+07:00","created_by":"abuabdirohman","updated_at":"2026-01-28T12:08:50.537022+07:00","closed_at":"2026-01-28T12:08:50.537022+07:00","close_reason":"Closed","dependencies":[{"issue_id":"bp-ckc","depends_on_id":"bp-2we","type":"parent-child","created_at":"2026-01-28T10:59:16.499334+07:00","created_by":"abuabdirohman"}],"comments":[{"id":32,"issue_id":"bp-ckc","author":"abuabdirohman","text":"Add notification settings ke user_profiles table: notification_enabled, daily_enabled, weekly_enabled, monthly_enabled, quarterly_enabled, daily_time (UTC+7), ai_character (4 options), timezone. Update existing user_profiles schema migration.","created_at":"2026-01-28T03:59:38Z"},{"id":36,"issue_id":"bp-ckc","author":"abuabdirohman","text":"✓ Completed: Added notification_settings JSONB column to user_profiles table with default values (email_enabled, daily/weekly/monthly/quarterly settings, ai_character: motivational|analytical|balanced|friendly, timezone: Asia/Jakarta). Migration: add_notification_settings_to_user_profiles","created_at":"2026-01-28T05:08:50Z"}]}
{"id":"bp-dtr","title":"Feature: Reset pomodoro timer display on day change","description":"The pomodoro timer should reset its displayed task when the day changes. Currently, tasks from the previous day are still shown in the timer interface after midnight.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-12T16:06:00+07:00","created_by":"abuabdirohman","updated_at":"2026-01-12T16:43:06.540708+07:00","closed_at":"2026-01-12T16:45:00+07:00","comments":[{"id":13,"issue_id":"bp-dtr","author":"abuabdirohman","text":"## Problem\nSaat sudah ganti hari, task yang dikerjakan di hari kemarin masih tampil di pomodoro timer.\n\n## Expected Behavior\nPomodoro timer harus tereset setiap ganti hari:\n- Active task display di-clear\n- Timer state di-reset\n- User harus memilih task baru untuk hari ini\n\n## Solution\n1. Store selectedDate/currentDate di timer state\n2. Saat app load atau detect date change, compare dengan stored date\n3. Jika berbeda, reset timer state\n4. Atau gunakan localStorage dengan date-based key","created_at":"2026-01-12T09:06:00Z"},{"id":16,"issue_id":"bp-dtr","author":"system","text":"Implemented by adding checkDailyReset() to timerStore and calling it on mount in PomodoroTimer. The state now tracks lastUpdatedDay in localStorage.","created_at":"2026-01-12T09:45:00Z"}]}
{"id":"bp-ep1","title":"Create email templates using React Email","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-28T10:43:44.892356+07:00","created_by":"abuabdirohman","updated_at":"2026-01-28T10:43:44.892356+07:00","dependencies":[{"issue_id":"bp-ep1","depends_on_id":"bp-2we","type":"parent-child","created_at":"2026-01-28T10:59:18.104378+07:00","created_by":"abuabdirohman"}]}
{"id":"bp-fgb","title":"Create notification_queue table","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-28T10:43:28.399598+07:00","created_by":"abuabdirohman","updated_at":"2026-01-28T12:10:19.443569+07:00","closed_at":"2026-01-28T12:10:19.443569+07:00","close_reason":"Closed","dependencies":[{"issue_id":"bp-fgb","depends_on_id":"bp-2we","type":"parent-child","created_at":"2026-01-28T10:59:17.048842+07:00","created_by":"abuabdirohman"}],"comments":[{"id":38,"issue_id":"bp-fgb","author":"abuabdirohman","text":"✓ Completed: Created notification_queue table with queue management (status, retry logic, max 3 retries), email content storage, Resend provider tracking, error tracking, and cleanup function for old items (30 days). Includes 4 optimized indexes and RLS policies. Migration: create_notification_queue_table","created_at":"2026-01-28T05:10:19Z"}]}
{"id":"bp-fjq","title":"Fix: DailyQuestModal tidak filter by quarter aktif","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-12T15:37:48.014515+07:00","created_by":"abuabdirohman","updated_at":"2026-01-12T15:51:25.145013+07:00","closed_at":"2026-01-12T15:50:00+07:00","comments":[{"id":9,"issue_id":"bp-fjq","author":"abuabdirohman","text":"## Problem\nDailyQuestModal di halaman daily-sync menampilkan tasks dari semua quarter, tidak terfilter by quarter aktif. User melaporkan task dari quarter sebelumnya masih muncul.\n\n## Root Cause\nFungsi `useDailyQuestsForSelection()` di `src/app/(admin)/execution/daily-sync/DailyQuest/hooks/useDailyPlanManagement.ts:202-221` melakukan query tanpa filter quarter:\n\n```typescript\nconst { data, error } = await supabase\n  .from('tasks')\n  .select('*')\n  .eq('user_id', user.id)\n  .eq('type', 'DAILY_QUEST')\n  .order('created_at', { ascending: false });\n```\n\n## Solution\n1. Update `useDailyQuestsForSelection()` untuk terima parameter `year` dan `quarter`\n2. Import `getQuarterDates` dari '@/lib/quarterUtils'\n3. Tambahkan quarter filtering:\n   ```typescript\n   const { startDate, endDate } = getQuarterDates(year, quarter);\n   // Add to query:\n   .gte('created_at', startDate.toISOString())\n   .lte('created_at', endDate.toISOString())\n   ```\n4. Update SWR key: `dailySyncKeys.dailyQuests(year, quarter)`\n5. Update caller di `useDailyPlanManagement()` line 290 untuk pass year \u0026 quarter\n\n## Implementation Pattern\nIkuti pattern yang sama seperti:\n- side-quests (src/app/(admin)/quests/side-quests/actions/sideQuestActions.ts:8-38)\n- work-quests (src/app/(admin)/quests/work-quests/actions/workQuestActions.ts:16-44)\n\n## Files to Modify\n- src/app/(admin)/execution/daily-sync/DailyQuest/hooks/useDailyPlanManagement.ts (lines 202-221, 290)","created_at":"2026-01-12T08:38:01Z"},{"id":11,"issue_id":"bp-fjq","author":"system","text":"Fixed: Implemented quarter filtering in useDailyQuestsForSelection():\n1. Updated SWR key in swr.ts to accept year/quarter params\n2. Added getQuarterDates import and filtering to useDailyQuestsForSelection\n3. Updated caller to derive quarter from weekNumber using getQuarterFromWeek()\n4. TypeScript compilation passed","created_at":"2026-01-12T08:50:00Z"}]}
{"id":"bp-hoz","title":"Fix DailyQuestModal to filter by active quarter","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T14:40:34.046481+07:00","created_by":"abuabdirohman","updated_at":"2026-01-12T15:51:25.163684+07:00","closed_at":"2026-01-12T15:50:00+07:00","dependencies":[{"issue_id":"bp-hoz","depends_on_id":"bp-ucc","type":"blocks","created_at":"2026-01-12T14:44:50.833387+07:00","created_by":"abuabdirohman"},{"issue_id":"bp-hoz","depends_on_id":"bp-fjq","type":"blocks","created_at":"2026-01-12T15:38:43.933072+07:00","created_by":"abuabdirohman"}],"comments":[{"id":5,"issue_id":"bp-hoz","author":"abuabdirohman","text":"\n## Problem\nDailyQuestModal di daily-sync menampilkan semua daily quest dari semua quarter, bukan hanya quarter aktif.\n\n## Root Cause\n- File: src/app/(admin)/execution/daily-sync/DailyQuest/hooks/useDailyPlanManagement.ts:202\n- Function: useDailyQuestsForSelection()\n- Query tidak filter by year \u0026 quarter:\n  ```sql\n  SELECT * FROM tasks \n  WHERE type='DAILY_QUEST' AND is_archived=false\n  ```\n\n## Dependency\n- BLOCKED BY: bp-ucc (need to verify if tasks table has year/quarter columns)\n\n## Solution (if tasks table has year/quarter)\n1. Update useDailyQuestsForSelection() to accept year \u0026 quarter parameters\n2. Add filters: .eq('year', year).eq('quarter', quarter)\n3. Update useDailyPlanManagement to pass year \u0026 quarter from useQuarterStore\n\n## Solution (if tasks table does NOT have year/quarter)\n1. Check if there's a foreign key to another table (e.g., quest_id -\u003e quests table)\n2. Use JOIN or separate query to filter by quarter\n3. Or use the existing useDailyQuests(year, quarter) hook from quests/daily-quests\n\n## Files to Modify\n- src/app/(admin)/execution/daily-sync/DailyQuest/hooks/useDailyPlanManagement.ts\n\n## Testing\n- Buka daily-sync page\n- Klik tombol 'Add' di Daily Quest section\n- Verify: Hanya menampilkan daily quest dari quarter aktif\n- Change quarter selector\n- Verify: List quest berubah sesuai quarter yang dipilih\n","created_at":"2026-01-12T07:41:55Z"},{"id":12,"issue_id":"bp-hoz","author":"system","text":"Fixed via bp-fjq implementation. Quarter filtering now uses getQuarterDates() pattern.","created_at":"2026-01-12T08:50:00Z"}]}
{"id":"bp-kfq","title":"Fix task state reversion bug in Side Quest \u0026 Work Quest","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-13T07:43:29.028399+07:00","created_by":"abuabdirohman","updated_at":"2026-01-13T08:09:15.689903+07:00","closed_at":"2026-01-13T08:09:15.689903+07:00","close_reason":"Closed","labels":["daily-sync","state-management"],"comments":[{"id":22,"issue_id":"bp-kfq","author":"abuabdirohman","text":"ROOT CAUSE:\n1. Missing focus_duration field when adding new side/work quests (sideQuestActions.ts:45-50)\n2. Falsy operator bug in setDailyPlan() - uses || instead of ?? causing 0 to become 25 (dailyPlanActions.ts:57)\n\nIMPACT:\nWhen adding new Side Quest or Work Quest, previously checked tasks (checklist mode, focus_duration=0) revert to timer mode (focus_duration=25).\n\nFIX LOCATIONS:\n1. sideQuestActions.ts:45-50 - Add focus_duration: 25 when inserting\n2. workQuestActions.ts (similar) - Add focus_duration: 25 when inserting  \n3. dailyPlanActions.ts:57 - Change || to ?? for nullish coalescing\n\nTECHNICAL DETAIL:\nTaskItemCard.tsx:140 detects checklist mode via focus_duration === 0. The setDailyPlan() function deletes and re-inserts items, but existingItem?.focus_duration || 25 treats 0 as falsy, resetting to 25.","created_at":"2026-01-13T00:43:40Z"},{"id":23,"issue_id":"bp-kfq","author":"abuabdirohman","text":"FIXED:\n1. sideQuestActions.ts:50 - Added focus_duration: 25 when inserting new Side Quest\n2. dailyPlanActions.ts:56-57 - Changed || to ?? operator (nullish coalescing) for both daily_session_target and focus_duration to prevent 0 being treated as falsy\n\nVERIFICATION:\n- Type check passed successfully\n- Work Quest uses setDailyPlan() function which is now fixed\n- Side Quest direct insertion now includes focus_duration field","created_at":"2026-01-13T01:09:09Z"}]}
{"id":"bp-ob7","title":"Add environment variables and deploy configuration","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-28T10:44:01.766306+07:00","created_by":"abuabdirohman","updated_at":"2026-01-28T10:44:01.766306+07:00","dependencies":[{"issue_id":"bp-ob7","depends_on_id":"bp-2we","type":"parent-child","created_at":"2026-01-28T10:59:19.203996+07:00","created_by":"abuabdirohman"}],"comments":[{"id":35,"issue_id":"bp-ob7","author":"abuabdirohman","text":"Add env vars: RESEND_API_KEY, GEMINI_API_KEY, CRON_SECRET_TOKEN, EMAIL_FROM. Update .env.example. Deploy to Vercel staging for testing.","created_at":"2026-01-28T03:59:47Z"}]}
{"id":"bp-rxi","title":"Fix: Foreign key constraint error saat delete task yang punya timer_sessions","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-12T15:38:08.689922+07:00","created_by":"abuabdirohman","updated_at":"2026-01-12T16:13:29.289194+07:00","closed_at":"2026-01-12T16:15:00+07:00","comments":[{"id":10,"issue_id":"bp-rxi","author":"abuabdirohman","text":"## Problem\nSaat user menghapus task (side quest, work quest, daily quest) yang sudah pernah dijalankan dengan timer, muncul error:\n```\nError: update or delete on table \"tasks\" violates foreign key constraint \"timer_sessions_task_id_fkey\" on table \"timer_sessions\"\nCode: 23503\nDetails: Key is still referenced from table \"timer_sessions\"\n```\n\n## Root Cause\nTabel `timer_sessions` memiliki foreign key `task_id` yang mereferensi `tasks.id`. Saat task dihapus, ada timer sessions yang masih mereferensi task tersebut, causing FK constraint violation.\n\n## Solution\nSebelum delete task, hapus dulu semua timer_sessions yang terkait dengan task tersebut.\n\n## Implementation\nUpdate 5 delete functions berikut untuk menambahkan logic hapus timer_sessions dulu:\n\n### 1. deleteSideQuest()\n**File:** src/app/(admin)/quests/side-quests/actions/sideQuestActions.ts:108-133\n```typescript\n// Add before deleting task:\nawait supabase\n  .from('timer_sessions')\n  .delete()\n  .eq('task_id', taskId)\n  .eq('user_id', user.id);\n```\n\n### 2. deleteWorkQuest()\n**File:** src/app/(admin)/quests/work-quests/actions/workQuestActions.ts:248-285\n\n### 3. deleteWorkQuestProject()\n**File:** src/app/(admin)/quests/work-quests/actions/workQuestActions.ts:456-493\nNote: Ini perlu loop untuk delete timer_sessions dari semua subtasks dulu\n\n### 4. deleteWorkQuestTask()\n**File:** src/app/(admin)/quests/work-quests/actions/workQuestActions.ts:663-689\n\n### 5. deleteDailyQuest()\n**File:** src/app/(admin)/execution/daily-sync/DailyQuest/actions/dailyQuestActions.ts:75-95\n\n## Pattern to Follow\n```typescript\nexport async function deleteTask(taskId: string): Promise\u003cvoid\u003e {\n  const supabase = await createClient();\n  const { data: { user } } = await supabase.auth.getUser();\n  if (!user) throw new Error('User not authenticated');\n\n  try {\n    // 1. Delete timer sessions first\n    const { error: timerError } = await supabase\n      .from('timer_sessions')\n      .delete()\n      .eq('task_id', taskId)\n      .eq('user_id', user.id);\n    \n    if (timerError) throw timerError;\n\n    // 2. Then delete the task\n    const { error: taskError } = await supabase\n      .from('tasks')\n      .delete()\n      .eq('id', taskId)\n      .eq('user_id', user.id);\n    \n    if (taskError) throw taskError;\n\n    revalidatePath('/relevant-path');\n  } catch (error) {\n    console.error('Error deleting task:', error);\n    throw error;\n  }\n}\n```\n\n## Testing Checklist\n- [ ] Delete side quest yang punya timer sessions\n- [ ] Delete work quest project yang punya timer sessions di subtasks\n- [ ] Delete work quest task yang punya timer sessions\n- [ ] Delete daily quest yang punya timer sessions\n- [ ] Verify timer_sessions juga terhapus dari database\n- [ ] Verify tasks yang tidak punya timer_sessions masih bisa dihapus normal","created_at":"2026-01-12T08:38:28Z"},{"id":14,"issue_id":"bp-rxi","author":"system","text":"Fixed by adding deletion of timer_sessions and daily_plan_items before deleting the task in all deletion actions (side, work, daily). verified with tsc.","created_at":"2026-01-12T09:15:00Z"},{"id":18,"issue_id":"bp-rxi","author":"system","text":"Deepened the fix to include nested cascading deletions: `timer_events` (which blocks `timer_sessions`) and `activity_logs` (which blocks `tasks`). The deletion order is now: timer_events -\u003e timer_sessions -\u003e activity_logs -\u003e daily_plan_items -\u003e tasks. Applied to all 5 quest deletion actions.","created_at":"2026-01-12T10:20:00Z"}]}
{"id":"bp-t8p","title":"Create notification_history table","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-28T10:43:31.803717+07:00","created_by":"abuabdirohman","updated_at":"2026-01-28T12:11:14.044874+07:00","closed_at":"2026-01-28T12:11:14.044874+07:00","close_reason":"Closed","dependencies":[{"issue_id":"bp-t8p","depends_on_id":"bp-2we","type":"parent-child","created_at":"2026-01-28T10:59:17.311823+07:00","created_by":"abuabdirohman"}],"comments":[{"id":39,"issue_id":"bp-t8p","author":"abuabdirohman","text":"✓ Completed: Created notification_history table with 18 columns for tracking sent emails, preventing duplicates (unique constraint on user_id + type + period), engagement metrics (opens, clicks, unsubscribes), and analytics. Includes helper functions: is_notification_already_sent(), get_user_notification_stats(), cleanup_old_notification_history(). 7 indexes and RLS policies. Migration: create_notification_history_table","created_at":"2026-01-28T05:11:14Z"}]}
{"id":"bp-ucc","title":"Investigate: Check if tasks table has year/quarter columns","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T14:40:21.791717+07:00","created_by":"abuabdirohman","updated_at":"2026-01-12T15:06:56.859787+07:00","closed_at":"2026-01-12T15:06:56.859787+07:00","close_reason":"Closed","comments":[{"id":3,"issue_id":"bp-ucc","author":"abuabdirohman","text":"\n## Purpose\nSebelum fix DailyQuestModal, perlu dipastikan apakah tabel tasks memiliki kolom year dan quarter untuk filtering.\n\n## Steps\n1. Check database schema untuk tabel tasks\n2. Identify kolom yang tersedia untuk filtering by quarter\n3. Jika tidak ada kolom year/quarter, cek apakah ada foreign key ke tabel lain yang punya info quarter\n4. Document findings untuk digunakan di task bp-hoz\n\n## Expected Output\n- Dokumentasi struktur tabel tasks\n- Konfirmasi apakah bisa filter by year/quarter langsung\n- Jika tidak, dokumentasi alternatif approach (join dengan tabel lain, dll)\n","created_at":"2026-01-12T07:41:27Z"},{"id":7,"issue_id":"bp-ucc","author":"abuabdirohman","text":"Based on side-quests implementation, quarter filtering tidak memerlukan kolom year/quarter di tabel tasks. Pattern yang sudah ada:\n1. Gunakan useQuarterStore() untuk mendapat year \u0026 quarter aktif\n2. Gunakan getQuarterDates(year, quarter) untuk mendapat startDate \u0026 endDate\n3. Filter di database dengan created_at \u003e= startDate AND created_at \u003c= endDate\n4. Implementasi sudah berjalan di side-quests (lihat src/app/(admin)/quests/side-quests/actions/sideQuestActions.ts:18-26)\n\nSolusi untuk DailyQuestModal dan WorkQuestModal: ikuti pattern yang sama tanpa perlu tambahan kolom.","created_at":"2026-01-12T08:00:42Z"}]}
{"id":"bp-vl4","title":"Create 6 Vercel Cron API routes (aggregate, queue, process)","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-28T10:43:53.970528+07:00","created_by":"abuabdirohman","updated_at":"2026-01-28T10:43:53.970528+07:00","dependencies":[{"issue_id":"bp-vl4","depends_on_id":"bp-2we","type":"parent-child","created_at":"2026-01-28T10:59:18.608614+07:00","created_by":"abuabdirohman"}],"comments":[{"id":34,"issue_id":"bp-vl4","author":"abuabdirohman","text":"Create 6 cron API routes: aggregate-performance (daily midnight UTC), queue-daily-emails (6AM UTC = 1PM UTC+7), queue-weekly/monthly/quarterly, process-email-queue (every 15 min). Configure vercel.json. Add CRON_SECRET_TOKEN auth.","created_at":"2026-01-28T03:59:44Z"}]}
{"id":"bp-wns","title":"Create performance_summaries table","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-28T10:43:24.791253+07:00","created_by":"abuabdirohman","updated_at":"2026-01-28T12:09:37.086874+07:00","closed_at":"2026-01-28T12:09:37.086874+07:00","close_reason":"Closed","dependencies":[{"issue_id":"bp-wns","depends_on_id":"bp-2we","type":"parent-child","created_at":"2026-01-28T10:59:16.784379+07:00","created_by":"abuabdirohman"}],"comments":[{"id":37,"issue_id":"bp-wns","author":"abuabdirohman","text":"✓ Completed: Created performance_summaries table with 22 columns including metrics (focus_minutes, sessions, tasks, completion_rate), comparison fields (previous period diff), AI insights (JSONB), and RLS policies. Includes 5 indexes for query optimization. Migration: create_performance_summaries_table","created_at":"2026-01-28T05:09:37Z"}]}
{"id":"bp-z6k","title":"Fix: Filter quests by active quarter in daily-sync modals","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-12T14:35:25.348477+07:00","created_by":"abuabdirohman","updated_at":"2026-01-13T05:03:41.068204+07:00","closed_at":"2026-01-13T05:03:41.068204+07:00","close_reason":"Completed with AI assistance in Google Antigravity","dependencies":[{"issue_id":"bp-z6k","depends_on_id":"bp-05y","type":"blocks","created_at":"2026-01-12T14:48:30.993872+07:00","created_by":"abuabdirohman"},{"issue_id":"bp-z6k","depends_on_id":"bp-hoz","type":"blocks","created_at":"2026-01-12T14:48:39.369024+07:00","created_by":"abuabdirohman"},{"issue_id":"bp-z6k","depends_on_id":"bp-1f6","type":"blocks","created_at":"2026-01-12T14:49:46.427581+07:00","created_by":"abuabdirohman"}],"comments":[{"id":1,"issue_id":"bp-z6k","author":"abuabdirohman","text":"\n## Problem\nDi halaman daily-sync (/execution/daily-sync), ada 3 modal untuk memilih quest:\n1. Work Quest Modal - Menampilkan semua work quest dari semua quarter\n2. Side Quest Modal - Sudah benar (sudah filter by quarter) ✅\n3. Daily Quest Modal - Perlu dicek sumber data tasks-nya\n\n## Root Cause\nWorkQuestModal menggunakan useWorkQuests() tanpa parameter year \u0026 quarter, sehingga menampilkan semua quest dari semua quarter.\n\n## Expected Behavior\nSetiap modal hanya menampilkan quest dari quarter yang aktif saja (sesuai dengan quarter context dari useQuarterStore).\n\n## Files to Fix\n1. src/app/(admin)/execution/daily-sync/DailyQuest/components/WorkQuestModal.tsx\n   - Line 39: useWorkQuests() perlu tambah parameter (year, quarter)\n   - Perlu import useQuarterStore dan pass year \u0026 quarter ke hook\n\n2. src/app/(admin)/execution/daily-sync/DailyQuest/components/DailyQuestModal.tsx\n   - Perlu investigasi dari mana data tasks berasal\n   - Pastikan sudah filtered by quarter\n\n## Success Criteria\n- Work Quest Modal hanya menampilkan quest dari quarter aktif\n- Daily Quest Modal hanya menampilkan quest dari quarter aktif\n- Side Quest Modal tetap bekerja dengan benar (sudah OK)\n","created_at":"2026-01-12T07:38:31Z"},{"id":2,"issue_id":"bp-z6k","author":"abuabdirohman","text":"\n## Technical Analysis Complete\n\n### Current Implementation Issues:\n\n1. **WorkQuestModal (CRITICAL)**\n   - File: src/app/(admin)/execution/daily-sync/DailyQuest/components/WorkQuestModal.tsx:39\n   - Uses: useWorkQuests() - tanpa parameter year \u0026 quarter\n   - Hook location: src/app/(admin)/quests/work-quests/hooks/useWorkQuests.ts:27\n   - Hook useWorkQuests() tidak accept parameter year/quarter\n   - Tapi ada hook alternatif useWorkQuestProjects(year, quarter) di line 97 yang sudah support filtering\n\n2. **DailyQuestModal (CRITICAL)**  \n   - File: src/app/(admin)/execution/daily-sync/DailyQuest/hooks/useDailyPlanManagement.ts:202\n   - Function: useDailyQuestsForSelection()\n   - Query: SELECT * FROM tasks WHERE type='DAILY_QUEST' AND is_archived=false\n   - MISSING: Filter by year \u0026 quarter\n   - Perlu tambahkan .eq('year', year).eq('quarter', quarter)\n\n3. **SideQuestModal (OK ✅)**\n   - File: src/app/(admin)/execution/daily-sync/DailyQuest/components/SideQuestModal.tsx:28-29\n   - Sudah menggunakan useQuarterStore() dan useSideQuests(year, quarter)\n   - Sudah benar, tidak perlu diubah\n\n### Implementation Plan:\n\n**Task 1: Fix WorkQuestModal**\n- Update WorkQuestModal.tsx untuk menggunakan useWorkQuestProjects(year, quarter) instead of useWorkQuests()\n- Import useQuarterStore untuk mendapatkan year \u0026 quarter context\n- Update data mapping karena structure berbeda (projects vs work quests)\n\n**Task 2: Fix DailyQuestModal** \n- Update useDailyQuestsForSelection() di useDailyPlanManagement.ts\n- Tambahkan parameter year \u0026 quarter\n- Update query untuk filter by year \u0026 quarter\n- Perlu investigasi apakah tabel tasks punya kolom year \u0026 quarter\n\n**Task 3: Testing**\n- Test semua 3 modals menampilkan hanya quest dari quarter aktif\n- Test switching quarter via quarter selector\n- Test data consistency\n","created_at":"2026-01-12T07:40:12Z"}]}
