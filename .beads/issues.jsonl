{"id":"bp-05y","title":"Fix WorkQuestModal to filter by active quarter","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T14:40:28.535217+07:00","created_by":"abuabdirohman","updated_at":"2026-01-12T15:18:39.515598+07:00","closed_at":"2026-01-12T15:18:39.515598+07:00","close_reason":"Closed","comments":[{"id":4,"issue_id":"bp-05y","author":"abuabdirohman","text":"\n## Problem\nWorkQuestModal di daily-sync menampilkan semua work quest dari semua quarter, bukan hanya quarter aktif.\n\n## Root Cause\n- File: src/app/(admin)/execution/daily-sync/DailyQuest/components/WorkQuestModal.tsx:39\n- Menggunakan: useWorkQuests() tanpa parameter\n- Hook ini tidak support filtering by year/quarter\n\n## Solution\n1. Import useQuarterStore untuk mendapatkan year \u0026 quarter context\n2. Ganti dari useWorkQuests() ke useWorkQuestProjects(year, quarter)\n3. Update data structure mapping karena useWorkQuestProjects return projects dengan nested tasks\n4. Current structure: workQuests (flat list)\n5. New structure: projects (list of projects with tasks)\n\n## Files to Modify\n- src/app/(admin)/execution/daily-sync/DailyQuest/components/WorkQuestModal.tsx\n\n## Implementation Details\n```typescript\n// OLD:\nconst { workQuests, isLoading: workQuestsLoading } = useWorkQuests();\n\n// NEW:\nconst { year, quarter } = useQuarterStore();\nconst { projects, isLoading: workQuestsLoading } = useWorkQuestProjects(year, quarter);\n// Then map projects to hierarchicalItems structure (already exists in modal)\n```\n\n## Testing\n- Buka daily-sync page\n- Klik tombol 'Add' di Work Quest section\n- Verify: Hanya menampilkan work quest dari quarter aktif\n- Change quarter selector\n- Verify: List quest berubah sesuai quarter yang dipilih\n","created_at":"2026-01-12T07:41:42Z"},{"id":8,"issue_id":"bp-05y","author":"abuabdirohman","text":"Fixed WorkQuestModal quarter filtering implementation:\n\n1. Updated getWorkQuests() action to accept year \u0026 quarter parameters\n2. Added quarter date filtering using getQuarterDates() (same pattern as side-quests)\n3. Filters work quests by created_at between startDate and endDate\n4. Updated useWorkQuests() hook to accept and pass year \u0026 quarter parameters\n5. Updated SWR key to include year \u0026 quarter for proper cache invalidation\n6. Updated WorkQuestModal in daily-sync to use useQuarterStore()\n7. All TypeScript checks passed\n\nChanges made:\n- src/app/(admin)/quests/work-quests/actions/workQuestActions.ts:16-44\n- src/app/(admin)/quests/work-quests/hooks/useWorkQuests.ts:27-41\n- src/app/(admin)/execution/daily-sync/DailyQuest/components/WorkQuestModal.tsx:3,40-41","created_at":"2026-01-12T08:18:31Z"}]}
{"id":"bp-1f6","title":"Testing: Verify all modals filter by active quarter","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T14:48:55.617685+07:00","created_by":"abuabdirohman","updated_at":"2026-01-12T14:48:55.617685+07:00","dependencies":[{"issue_id":"bp-1f6","depends_on_id":"bp-05y","type":"blocks","created_at":"2026-01-12T14:49:25.821204+07:00","created_by":"abuabdirohman"},{"issue_id":"bp-1f6","depends_on_id":"bp-hoz","type":"blocks","created_at":"2026-01-12T14:49:39.622555+07:00","created_by":"abuabdirohman"}],"comments":[{"id":6,"issue_id":"bp-1f6","author":"abuabdirohman","text":"\n## Purpose\nComprehensive testing untuk memastikan semua quest modals di daily-sync hanya menampilkan quest dari quarter aktif.\n\n## Prerequisites\n- bp-05y (WorkQuestModal fix) - DONE\n- bp-hoz (DailyQuestModal fix) - DONE\n\n## Test Cases\n\n### 1. WorkQuestModal\n- [ ] Buka /execution/daily-sync\n- [ ] Note current quarter (e.g., Q1 2026)\n- [ ] Click 'Add' button di Work Quest section\n- [ ] Verify: Modal hanya menampilkan work quests dari Q1 2026\n- [ ] Close modal\n- [ ] Switch quarter selector ke Q2\n- [ ] Click 'Add' button di Work Quest section\n- [ ] Verify: Modal sekarang menampilkan work quests dari Q2\n- [ ] Verify: Quest dari Q1 tidak muncul\n\n### 2. DailyQuestModal\n- [ ] Buka /execution/daily-sync\n- [ ] Note current quarter (e.g., Q1 2026)\n- [ ] Click 'Add' button di Daily Quest section\n- [ ] Verify: Modal hanya menampilkan daily quests dari Q1 2026\n- [ ] Close modal\n- [ ] Switch quarter selector ke Q2\n- [ ] Click 'Add' button di Daily Quest section\n- [ ] Verify: Modal sekarang menampilkan daily quests dari Q2\n- [ ] Verify: Quest dari Q1 tidak muncul\n\n### 3. SideQuestModal (Regression Test)\n- [ ] Buka /execution/daily-sync\n- [ ] Note current quarter (e.g., Q1 2026)\n- [ ] Click 'Add' button di Side Quest section\n- [ ] Verify: Modal hanya menampilkan side quests dari Q1 2026\n- [ ] Switch quarter selector ke Q2\n- [ ] Click 'Add' button di Side Quest section\n- [ ] Verify: Modal sekarang menampilkan side quests dari Q2\n- [ ] Verify: Masih bekerja dengan benar (tidak ada regression)\n\n### 4. Cross-Quarter Data Consistency\n- [ ] Buat work quest baru di Q1\n- [ ] Buat daily quest baru di Q1\n- [ ] Switch ke Q2\n- [ ] Verify: Quest Q1 tidak muncul di modal manapun\n- [ ] Switch kembali ke Q1\n- [ ] Verify: Quest Q1 muncul kembali\n\n### 5. Edge Cases\n- [ ] Test dengan quarter yang tidak punya quest sama sekali\n- [ ] Verify: Modal menampilkan empty state yang appropriate\n- [ ] Test dengan multiple quests (10+) di satu quarter\n- [ ] Verify: Semua quest ter-render dengan benar\n- [ ] Test search/filter di dalam modal (if applicable)\n- [ ] Verify: Search tetap dalam scope quarter aktif\n\n## Success Criteria\n- Semua 3 modals (Work, Daily, Side) hanya menampilkan quest dari quarter aktif\n- Quarter switching bekerja dengan smooth tanpa bugs\n- Tidak ada quest dari quarter lain yang muncul\n- Empty states ditampilkan dengan benar\n- No console errors\n- No performance issues\n","created_at":"2026-01-12T07:49:16Z"}]}
{"id":"bp-346","title":"Fix: Pomodoro timer task becomes unclickable after completion","description":"Bug: After Pomodoro timer completes, the task in the timer interface becomes unclickable. Users must click on the quest card itself to restart the timer, instead of being able to click directly on the task in the timer interface.\n\nSteps to reproduce:\n1. Start a Pomodoro timer for a task\n2. Wait for timer to complete\n3. Try to click on the task in the timer interface\n4. Task is unclickable\n\nExpected behavior: Task should remain clickable in the timer interface after completion\n\nCurrent workaround: Click on the quest card to restart timer","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-07T22:30:55.346602+07:00","created_by":"abuabdirohman","updated_at":"2026-01-09T09:36:50.225389+07:00","labels":["bug","pomodoro","timer","ui"]}
{"id":"bp-hoz","title":"Fix DailyQuestModal to filter by active quarter","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T14:40:34.046481+07:00","created_by":"abuabdirohman","updated_at":"2026-01-12T14:40:34.046481+07:00","dependencies":[{"issue_id":"bp-hoz","depends_on_id":"bp-ucc","type":"blocks","created_at":"2026-01-12T14:44:50.833387+07:00","created_by":"abuabdirohman"}],"comments":[{"id":5,"issue_id":"bp-hoz","author":"abuabdirohman","text":"\n## Problem\nDailyQuestModal di daily-sync menampilkan semua daily quest dari semua quarter, bukan hanya quarter aktif.\n\n## Root Cause\n- File: src/app/(admin)/execution/daily-sync/DailyQuest/hooks/useDailyPlanManagement.ts:202\n- Function: useDailyQuestsForSelection()\n- Query tidak filter by year \u0026 quarter:\n  ```sql\n  SELECT * FROM tasks \n  WHERE type='DAILY_QUEST' AND is_archived=false\n  ```\n\n## Dependency\n- BLOCKED BY: bp-ucc (need to verify if tasks table has year/quarter columns)\n\n## Solution (if tasks table has year/quarter)\n1. Update useDailyQuestsForSelection() to accept year \u0026 quarter parameters\n2. Add filters: .eq('year', year).eq('quarter', quarter)\n3. Update useDailyPlanManagement to pass year \u0026 quarter from useQuarterStore\n\n## Solution (if tasks table does NOT have year/quarter)\n1. Check if there's a foreign key to another table (e.g., quest_id -\u003e quests table)\n2. Use JOIN or separate query to filter by quarter\n3. Or use the existing useDailyQuests(year, quarter) hook from quests/daily-quests\n\n## Files to Modify\n- src/app/(admin)/execution/daily-sync/DailyQuest/hooks/useDailyPlanManagement.ts\n\n## Testing\n- Buka daily-sync page\n- Klik tombol 'Add' di Daily Quest section\n- Verify: Hanya menampilkan daily quest dari quarter aktif\n- Change quarter selector\n- Verify: List quest berubah sesuai quarter yang dipilih\n","created_at":"2026-01-12T07:41:55Z"}]}
{"id":"bp-ucc","title":"Investigate: Check if tasks table has year/quarter columns","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T14:40:21.791717+07:00","created_by":"abuabdirohman","updated_at":"2026-01-12T15:06:56.859787+07:00","closed_at":"2026-01-12T15:06:56.859787+07:00","close_reason":"Closed","comments":[{"id":3,"issue_id":"bp-ucc","author":"abuabdirohman","text":"\n## Purpose\nSebelum fix DailyQuestModal, perlu dipastikan apakah tabel tasks memiliki kolom year dan quarter untuk filtering.\n\n## Steps\n1. Check database schema untuk tabel tasks\n2. Identify kolom yang tersedia untuk filtering by quarter\n3. Jika tidak ada kolom year/quarter, cek apakah ada foreign key ke tabel lain yang punya info quarter\n4. Document findings untuk digunakan di task bp-hoz\n\n## Expected Output\n- Dokumentasi struktur tabel tasks\n- Konfirmasi apakah bisa filter by year/quarter langsung\n- Jika tidak, dokumentasi alternatif approach (join dengan tabel lain, dll)\n","created_at":"2026-01-12T07:41:27Z"},{"id":7,"issue_id":"bp-ucc","author":"abuabdirohman","text":"Based on side-quests implementation, quarter filtering tidak memerlukan kolom year/quarter di tabel tasks. Pattern yang sudah ada:\n1. Gunakan useQuarterStore() untuk mendapat year \u0026 quarter aktif\n2. Gunakan getQuarterDates(year, quarter) untuk mendapat startDate \u0026 endDate\n3. Filter di database dengan created_at \u003e= startDate AND created_at \u003c= endDate\n4. Implementasi sudah berjalan di side-quests (lihat src/app/(admin)/quests/side-quests/actions/sideQuestActions.ts:18-26)\n\nSolusi untuk DailyQuestModal dan WorkQuestModal: ikuti pattern yang sama tanpa perlu tambahan kolom.","created_at":"2026-01-12T08:00:42Z"}]}
{"id":"bp-z6k","title":"Fix: Filter quests by active quarter in daily-sync modals","status":"open","priority":2,"issue_type":"bug","created_at":"2026-01-12T14:35:25.348477+07:00","created_by":"abuabdirohman","updated_at":"2026-01-12T14:35:25.348477+07:00","dependencies":[{"issue_id":"bp-z6k","depends_on_id":"bp-05y","type":"blocks","created_at":"2026-01-12T14:48:30.993872+07:00","created_by":"abuabdirohman"},{"issue_id":"bp-z6k","depends_on_id":"bp-hoz","type":"blocks","created_at":"2026-01-12T14:48:39.369024+07:00","created_by":"abuabdirohman"},{"issue_id":"bp-z6k","depends_on_id":"bp-1f6","type":"blocks","created_at":"2026-01-12T14:49:46.427581+07:00","created_by":"abuabdirohman"}],"comments":[{"id":1,"issue_id":"bp-z6k","author":"abuabdirohman","text":"\n## Problem\nDi halaman daily-sync (/execution/daily-sync), ada 3 modal untuk memilih quest:\n1. Work Quest Modal - Menampilkan semua work quest dari semua quarter\n2. Side Quest Modal - Sudah benar (sudah filter by quarter) ✅\n3. Daily Quest Modal - Perlu dicek sumber data tasks-nya\n\n## Root Cause\nWorkQuestModal menggunakan useWorkQuests() tanpa parameter year \u0026 quarter, sehingga menampilkan semua quest dari semua quarter.\n\n## Expected Behavior\nSetiap modal hanya menampilkan quest dari quarter yang aktif saja (sesuai dengan quarter context dari useQuarterStore).\n\n## Files to Fix\n1. src/app/(admin)/execution/daily-sync/DailyQuest/components/WorkQuestModal.tsx\n   - Line 39: useWorkQuests() perlu tambah parameter (year, quarter)\n   - Perlu import useQuarterStore dan pass year \u0026 quarter ke hook\n\n2. src/app/(admin)/execution/daily-sync/DailyQuest/components/DailyQuestModal.tsx\n   - Perlu investigasi dari mana data tasks berasal\n   - Pastikan sudah filtered by quarter\n\n## Success Criteria\n- Work Quest Modal hanya menampilkan quest dari quarter aktif\n- Daily Quest Modal hanya menampilkan quest dari quarter aktif\n- Side Quest Modal tetap bekerja dengan benar (sudah OK)\n","created_at":"2026-01-12T07:38:31Z"},{"id":2,"issue_id":"bp-z6k","author":"abuabdirohman","text":"\n## Technical Analysis Complete\n\n### Current Implementation Issues:\n\n1. **WorkQuestModal (CRITICAL)**\n   - File: src/app/(admin)/execution/daily-sync/DailyQuest/components/WorkQuestModal.tsx:39\n   - Uses: useWorkQuests() - tanpa parameter year \u0026 quarter\n   - Hook location: src/app/(admin)/quests/work-quests/hooks/useWorkQuests.ts:27\n   - Hook useWorkQuests() tidak accept parameter year/quarter\n   - Tapi ada hook alternatif useWorkQuestProjects(year, quarter) di line 97 yang sudah support filtering\n\n2. **DailyQuestModal (CRITICAL)**  \n   - File: src/app/(admin)/execution/daily-sync/DailyQuest/hooks/useDailyPlanManagement.ts:202\n   - Function: useDailyQuestsForSelection()\n   - Query: SELECT * FROM tasks WHERE type='DAILY_QUEST' AND is_archived=false\n   - MISSING: Filter by year \u0026 quarter\n   - Perlu tambahkan .eq('year', year).eq('quarter', quarter)\n\n3. **SideQuestModal (OK ✅)**\n   - File: src/app/(admin)/execution/daily-sync/DailyQuest/components/SideQuestModal.tsx:28-29\n   - Sudah menggunakan useQuarterStore() dan useSideQuests(year, quarter)\n   - Sudah benar, tidak perlu diubah\n\n### Implementation Plan:\n\n**Task 1: Fix WorkQuestModal**\n- Update WorkQuestModal.tsx untuk menggunakan useWorkQuestProjects(year, quarter) instead of useWorkQuests()\n- Import useQuarterStore untuk mendapatkan year \u0026 quarter context\n- Update data mapping karena structure berbeda (projects vs work quests)\n\n**Task 2: Fix DailyQuestModal** \n- Update useDailyQuestsForSelection() di useDailyPlanManagement.ts\n- Tambahkan parameter year \u0026 quarter\n- Update query untuk filter by year \u0026 quarter\n- Perlu investigasi apakah tabel tasks punya kolom year \u0026 quarter\n\n**Task 3: Testing**\n- Test semua 3 modals menampilkan hanya quest dari quarter aktif\n- Test switching quarter via quarter selector\n- Test data consistency\n","created_at":"2026-01-12T07:40:12Z"}]}
